
[DEBUG] [2018-12-21 00:00:33,975] [21] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:00:34,057] [21] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:00:34,062] [21] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:00:34,064] [21] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:00:34,066] [21] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:00:34,069] [21] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:00:34,075] [21] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:00:34,075] [21] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:00:36,573] [21] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:00:36,579] [21] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('27ab8affc91746e7856010f9f29f3b6a','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:00:36','yyyy/mm/dd hh24:mi:ss'),'27ab8affc91746e7856010f9f29f3b6a.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:00:36','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:00:36','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 00:00:36,584] [21] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:00:36,589] [21] [BetchLogic > run > 开始导入:2018/12/21 上午12:00:36]
[INFO ] [2018-12-21 00:00:37,345] [21] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:00:37,678] [21] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:00:37,977] [21] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:00:39,225] [21] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:00:39,497] [21] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:00:39,803] [21] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:00:40,076] [21] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:00:40,352] [21] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:00:40,658] [21] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:00:40,932] [21] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:00:40,932] [21] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 00:00:41,288] [15] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:00:41,313] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:00:41,316] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:00:41,317] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:00:41,318] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:00:41,319] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:00:41,324] [15] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:00:41,324] [15] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:00:46,153] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:00:46,156] [15] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('c70fcce6268a47fb95bc9b3567a30d56','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:00:46','yyyy/mm/dd hh24:mi:ss'),'c70fcce6268a47fb95bc9b3567a30d56.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:00:46','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:00:46','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 00:00:46,158] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:00:46,161] [15] [BetchLogic > run > 开始导入:2018/12/21 上午12:00:46]
[INFO ] [2018-12-21 00:00:46,472] [15] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:00:46,749] [15] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:00:47,142] [15] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:00:47,422] [15] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:00:47,728] [15] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:00:48,509] [15] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:00:48,825] [15] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:00:49,105] [15] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:00:49,418] [15] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:00:49,694] [15] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:00:49,695] [15] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 00:28:08,288] [45] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:28:08,373] [45] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:28:08,379] [45] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:28:08,380] [45] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:28:08,383] [45] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:28:08,386] [45] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:28:08,391] [45] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:28:08,392] [45] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:28:09,028] [45] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:28:09,033] [45] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('05de1b943809413c9c4b9025e4c349f0','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:28:09','yyyy/mm/dd hh24:mi:ss'),'05de1b943809413c9c4b9025e4c349f0.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:28:09','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:28:09','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 00:28:09,038] [45] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:28:09,042] [45] [BetchLogic > run > 开始导入:2018/12/21 上午12:28:09]
[INFO ] [2018-12-21 00:28:09,886] [45] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:28:10,211] [45] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:28:10,488] [45] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:28:10,803] [45] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:28:11,069] [45] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:28:11,392] [45] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:28:12,324] [45] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:28:12,640] [45] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:28:12,946] [45] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:28:13,289] [45] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:28:13,289] [45] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 00:28:13,598] [44] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:28:13,625] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:28:13,629] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:28:13,630] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:28:13,631] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:28:13,632] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:28:13,635] [44] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:28:13,635] [44] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:28:15,866] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:28:15,870] [44] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('01e8f97167534d26915dcdb5b4d14e2e','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:28:15','yyyy/mm/dd hh24:mi:ss'),'01e8f97167534d26915dcdb5b4d14e2e.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:28:15','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:28:15','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 00:28:15,872] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:28:15,875] [44] [BetchLogic > run > 开始导入:2018/12/21 上午12:28:15]
[INFO ] [2018-12-21 00:28:18,428] [44] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:28:18,708] [44] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:28:19,020] [44] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:28:19,309] [44] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:28:19,614] [44] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:28:19,887] [44] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:28:20,230] [44] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:28:20,501] [44] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:28:21,959] [44] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:28:22,262] [44] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:28:22,262] [44] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 00:57:40,206] [7] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:57:40,267] [7] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:57:40,271] [7] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:57:40,272] [7] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:57:40,273] [7] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 00:57:40,274] [7] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:57:40,277] [7] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:57:40,277] [7] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:57:40,937] [7] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:57:40,940] [7] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('49f6bffcbb034d959dd56df47f26a73e','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:57:40','yyyy/mm/dd hh24:mi:ss'),'49f6bffcbb034d959dd56df47f26a73e.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:57:40','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:57:40','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 00:57:40,943] [7] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:57:40,947] [7] [BetchLogic > run > 开始导入:2018/12/21 上午12:57:40]
[INFO ] [2018-12-21 00:57:41,234] [7] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:57:41,527] [7] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:57:41,847] [7] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:57:42,114] [7] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:57:42,417] [7] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:57:42,685] [7] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:57:42,990] [7] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:57:43,257] [7] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:57:43,561] [7] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:57:43,833] [7] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:57:43,833] [7] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 00:58:50,281] [41] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 00:58:50,312] [41] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 00:58:50,315] [41] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:58:50,316] [41] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:58:50,317] [41] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 00:58:50,318] [41] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:58:50,324] [41] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 00:58:50,324] [41] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 00:58:53,676] [41] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 00:58:53,679] [41] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('5b36ab6c1bcd4421b8df36e20ac29f03','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 00:58:53','yyyy/mm/dd hh24:mi:ss'),'5b36ab6c1bcd4421b8df36e20ac29f03.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 00:58:53','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 00:58:53','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 00:58:53,681] [41] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 00:58:53,684] [41] [BetchLogic > run > 开始导入:2018/12/21 上午12:58:53]
[INFO ] [2018-12-21 00:58:54,832] [41] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 00:58:55,150] [41] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 00:58:55,458] [41] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 00:58:56,372] [41] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 00:58:56,696] [41] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 00:58:57,005] [41] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 00:58:57,319] [41] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 00:58:57,589] [41] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 00:58:57,911] [41] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 00:58:58,187] [41] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 00:58:58,187] [41] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:01:12,131] [46] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:01:12,158] [46] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:01:12,161] [46] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:01:12,162] [46] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:01:12,163] [46] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:01:12,164] [46] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:01:12,169] [46] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:01:12,169] [46] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:01:15,391] [46] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:01:15,395] [46] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('2d2bc0f9ae7c48a2a200327f8a63b3cd','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:01:15','yyyy/mm/dd hh24:mi:ss'),'2d2bc0f9ae7c48a2a200327f8a63b3cd.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:01:15','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:01:15','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 01:01:15,397] [46] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:01:15,400] [46] [BetchLogic > run > 开始导入:2018/12/21 上午1:01:15]
[INFO ] [2018-12-21 01:01:15,712] [46] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:01:16,027] [46] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:01:16,293] [46] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:01:18,074] [46] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:01:18,368] [46] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:01:18,654] [46] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:01:18,965] [46] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:01:19,256] [46] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:01:19,615] [46] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:01:19,902] [46] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:01:19,903] [46] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:03:56,454] [23] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:03:56,571] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:03:56,576] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:03:56,578] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:03:56,581] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:03:56,584] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:03:56,589] [23] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:03:56,590] [23] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:04:00,835] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:04:00,842] [23] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('2445ed139f174d8db36f06b686287ea6','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:04:00','yyyy/mm/dd hh24:mi:ss'),'2445ed139f174d8db36f06b686287ea6.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:04:00','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:04:00','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 01:04:00,847] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:04:00,850] [23] [BetchLogic > run > 开始导入:2018/12/21 上午1:04:00]
[INFO ] [2018-12-21 01:04:01,597] [23] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:04:01,921] [23] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:04:02,206] [23] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:04:02,513] [23] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:04:02,777] [23] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:04:03,086] [23] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:04:03,762] [23] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:04:04,064] [23] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:04:04,329] [23] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:04:04,625] [23] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:04:04,625] [23] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:06:27,751] [17] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:06:27,823] [17] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:06:27,827] [17] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:06:27,829] [17] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:06:27,830] [17] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 01:06:27,831] [17] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:06:27,835] [17] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:06:27,835] [17] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:06:31,302] [17] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:06:31,305] [17] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('ccc5f541cd2644c993bd6e95bbcf517a','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:06:31','yyyy/mm/dd hh24:mi:ss'),'ccc5f541cd2644c993bd6e95bbcf517a.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:06:31','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:06:31','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 01:06:31,307] [17] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:06:31,313] [17] [BetchLogic > run > 开始导入:2018/12/21 上午1:06:31]
[INFO ] [2018-12-21 01:06:31,588] [17] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:06:31,890] [17] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:06:32,158] [17] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:06:32,459] [17] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:06:32,734] [17] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:06:33,001] [17] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:06:33,299] [17] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:06:33,564] [17] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:06:34,433] [17] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:06:34,779] [17] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:06:34,779] [17] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:06:35,328] [49] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:06:35,361] [49] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:06:35,365] [49] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 01:06:35,366] [49] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 01:06:35,367] [49] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 01:06:35,368] [49] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:06:35,373] [49] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:06:35,373] [49] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:06:37,955] [49] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:06:37,958] [49] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('59216f92e7ce454ca99de2e22a855473','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:06:37','yyyy/mm/dd hh24:mi:ss'),'59216f92e7ce454ca99de2e22a855473.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:06:37','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:06:37','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 01:06:37,960] [49] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:06:37,968] [49] [BetchLogic > run > 开始导入:2018/12/21 上午1:06:37]
[INFO ] [2018-12-21 01:06:38,254] [49] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:06:40,498] [49] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:06:40,824] [49] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:06:41,110] [49] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:06:41,445] [49] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:06:41,755] [49] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:06:42,081] [49] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:06:42,353] [49] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:06:42,674] [49] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:06:42,963] [49] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:06:42,963] [49] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:07:04,946] [23] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:07:04,975] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:07:04,978] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:07:04,979] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:07:04,980] [23] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:07:04,984] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:07:04,988] [23] [BetchLogic > updateDbByID > 删除数据:TBL_20180916_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:07:04,988] [23] [	delete from TBL_20180916_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:07:04,993] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:07:04,996] [23] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('ab101e51e78b466b830bcc76376ec143','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:07:04','yyyy/mm/dd hh24:mi:ss'),'ab101e51e78b466b830bcc76376ec143.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:07:04','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:07:04','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'@1220,1.1.1.1,201809162018000,1.txt','TBL_20180916_DATA1','597b1554e30c401082625aa0d61cfcca')]
[DEBUG] [2018-12-21 01:07:04,998] [23] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:07:05,002] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE1 is '版1']
[DEBUG] [2018-12-21 01:07:05,004] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE2 is '版2']
[DEBUG] [2018-12-21 01:07:05,007] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE3 is '版3']
[DEBUG] [2018-12-21 01:07:05,009] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE4 is '版4']
[DEBUG] [2018-12-21 01:07:05,010] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE5 is '版5']
[DEBUG] [2018-12-21 01:07:05,012] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE6 is '版6']
[DEBUG] [2018-12-21 01:07:05,014] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE7 is '版7']
[DEBUG] [2018-12-21 01:07:05,015] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE8 is '版8']
[DEBUG] [2018-12-21 01:07:05,017] [23] [	comment on column TBL_20180916_DATA1.ATTRIBUTE9 is '版9']
[INFO ] [2018-12-21 01:07:05,019] [23] [BetchLogic > run > 开始导入:2018/12/21 上午1:07:05]
[INFO ] [2018-12-21 01:07:05,375] [23] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:07:05,669] [23] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:07:06,006] [23] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:07:06,285] [23] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:07:06,595] [23] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:07:06,883] [23] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:07:07,896] [23] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:07:08,222] [23] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:07:08,498] [23] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:07:08,812] [23] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:07:08,813] [23] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 01:09:35,122] [48] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 01:09:35,149] [48] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 01:09:35,152] [48] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:09:35,153] [48] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:09:35,154] [48] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='597b1554e30c401082625aa0d61cfcca']
[DEBUG] [2018-12-21 01:09:35,155] [48] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:09:35,158] [48] [BetchLogic > updateDbByID > 删除数据:TBL_20180916_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 01:09:35,158] [48] [	delete from TBL_20180916_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 01:09:41,399] [48] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 01:09:41,403] [48] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('83c6186a240141f9958ae0f0b6b66097','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 01:09:41','yyyy/mm/dd hh24:mi:ss'),'83c6186a240141f9958ae0f0b6b66097.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 01:09:41','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 01:09:41','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'模型机@1220,1.1.1.1,201809162018000,1.txt','TBL_20180916_DATA1','597b1554e30c401082625aa0d61cfcca')]
[DEBUG] [2018-12-21 01:09:41,405] [48] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_20180916_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 01:09:41,408] [48] [BetchLogic > run > 开始导入:2018/12/21 上午1:09:41]
[INFO ] [2018-12-21 01:09:41,675] [48] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 01:09:41,951] [48] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 01:09:42,288] [48] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 01:09:42,577] [48] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 01:09:42,866] [48] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 01:09:43,184] [48] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 01:09:43,507] [48] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 01:09:43,824] [48] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 01:09:44,470] [48] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 01:09:44,771] [48] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 01:09:44,771] [48] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 07:44:29,931] [87] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 07:44:30,012] [87] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 07:44:30,016] [87] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:44:30,018] [87] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:44:30,019] [87] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:44:30,020] [87] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:44:30,025] [87] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 07:44:30,025] [87] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 07:44:30,033] [87] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 07:44:30,036] [87] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('f44bdf6566064ee8b5a407b0729dcf46','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 07:44:30','yyyy/mm/dd hh24:mi:ss'),'f44bdf6566064ee8b5a407b0729dcf46.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 07:44:30','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 07:44:30','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 07:44:30,039] [87] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 07:44:30,044] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE10 is '数据1']
[DEBUG] [2018-12-21 07:44:30,046] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE11 is '数据2']
[DEBUG] [2018-12-21 07:44:30,049] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE12 is '数据3']
[DEBUG] [2018-12-21 07:44:30,051] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE13 is '数据4']
[DEBUG] [2018-12-21 07:44:30,053] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE14 is '数据5']
[DEBUG] [2018-12-21 07:44:30,054] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE15 is '数据6']
[DEBUG] [2018-12-21 07:44:30,057] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE16 is '数据7']
[DEBUG] [2018-12-21 07:44:30,060] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE17 is '数据8']
[DEBUG] [2018-12-21 07:44:30,062] [87] [	comment on column TBL_1220_DATA1.ATTRIBUTE18 is '数据9']
[INFO ] [2018-12-21 07:44:30,064] [87] [BetchLogic > run > 开始导入:2018/12/21 上午7:44:30]
[DEBUG] [2018-12-21 07:44:30,364] [89] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 07:44:30,396] [89] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 07:44:30,400] [89] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:44:30,401] [89] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:44:30,401] [89] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:44:30,402] [89] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:44:30,407] [89] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 07:44:30,407] [89] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 07:44:31,590] [89] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 07:44:31,594] [89] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('a5088895efe540ea88d0f79359e5c364','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 07:44:31','yyyy/mm/dd hh24:mi:ss'),'a5088895efe540ea88d0f79359e5c364.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 07:44:31','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 07:44:31','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 07:44:31,596] [89] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:44:31,600] [89] [BetchLogic > run > 开始导入:2018/12/21 上午7:44:31]
[INFO ] [2018-12-21 07:44:31,903] [89] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 07:44:32,207] [89] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 07:44:32,490] [89] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 07:44:32,799] [89] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 07:44:33,070] [89] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 07:44:35,467] [89] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 07:44:35,742] [89] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 07:44:36,665] [89] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 07:44:36,942] [89] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 07:44:37,290] [89] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 07:44:37,290] [89] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 07:46:57,611] [81] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 07:46:57,711] [81] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 07:46:57,716] [81] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:46:57,717] [81] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:46:57,721] [81] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 07:46:57,724] [81] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:46:57,730] [81] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 07:46:57,731] [81] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 07:46:57,739] [81] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 07:46:57,746] [81] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('94cbf1e2a76c4fb9ae20fb70a95e003d','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 07:46:57','yyyy/mm/dd hh24:mi:ss'),'94cbf1e2a76c4fb9ae20fb70a95e003d.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 07:46:57','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 07:46:57','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 07:46:57,751] [81] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:46:57,755] [81] [BetchLogic > run > 开始导入:2018/12/21 上午7:46:57]
[DEBUG] [2018-12-21 07:46:59,053] [78] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 07:46:59,076] [78] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 07:46:59,079] [78] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:46:59,080] [78] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:46:59,081] [78] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 07:46:59,083] [78] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:46:59,088] [78] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 07:46:59,088] [78] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 07:47:03,253] [78] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 07:47:03,257] [78] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('ec4b4bec6f80431bb5d424d48b4aa3f2','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 07:47:03','yyyy/mm/dd hh24:mi:ss'),'ec4b4bec6f80431bb5d424d48b4aa3f2.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 07:47:03','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 07:47:03','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 07:47:03,259] [78] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 07:47:03,262] [78] [BetchLogic > run > 开始导入:2018/12/21 上午7:47:03]
[INFO ] [2018-12-21 07:47:04,041] [78] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 07:47:04,367] [78] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 07:47:04,650] [78] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 07:47:04,966] [78] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 07:47:07,015] [78] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 07:47:07,290] [78] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 07:47:07,595] [78] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 07:47:07,871] [78] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 07:47:08,207] [78] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 07:47:08,504] [78] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 07:47:08,504] [78] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:03:41,099] [9] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:03:41,299] [9] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:03:41,306] [9] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:03:41,307] [9] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:03:41,310] [9] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:03:41,312] [9] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:03:41,318] [9] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:03:41,319] [9] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:03:41,325] [9] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:03:41,332] [9] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('f5c47386ee834c5cbd540ca4fec506d1','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:03:41','yyyy/mm/dd hh24:mi:ss'),'f5c47386ee834c5cbd540ca4fec506d1.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:03:41','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:03:41','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 10:03:41,337] [9] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:03:41,341] [9] [BetchLogic > run > 开始导入:2018/12/21 上午10:03:41]
[INFO ] [2018-12-21 10:03:42,122] [9] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:03:42,435] [9] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:03:42,728] [9] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:03:43,061] [9] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:03:43,333] [9] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:03:43,667] [9] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:03:43,950] [9] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:03:44,258] [9] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:03:44,543] [9] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:03:44,918] [9] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:03:44,919] [9] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:05:02,374] [15] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:05:02,402] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:05:02,405] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:05:02,407] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:05:02,407] [15] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:05:02,408] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:05:02,411] [15] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:05:02,412] [15] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:05:05,511] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:05:05,515] [15] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('3d6a2b5b33734b69a134103398af4e98','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:05:05','yyyy/mm/dd hh24:mi:ss'),'3d6a2b5b33734b69a134103398af4e98.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:05:05','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:05:05','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 10:05:05,517] [15] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:05:05,519] [15] [BetchLogic > run > 开始导入:2018/12/21 上午10:05:05]
[INFO ] [2018-12-21 10:05:05,780] [15] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:05:06,048] [15] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:05:06,361] [15] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:05:08,418] [15] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:05:08,731] [15] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:05:08,998] [15] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:05:09,303] [15] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:05:09,568] [15] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:05:09,860] [15] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:05:10,140] [15] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:05:10,140] [15] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:05:11,476] [14] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:05:11,507] [14] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:05:11,511] [14] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:05:11,512] [14] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:05:11,513] [14] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:05:11,514] [14] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:05:11,518] [14] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:05:11,518] [14] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:05:14,926] [14] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:05:14,929] [14] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('3fd59508b475406abdf88b433b4c1e94','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:05:14','yyyy/mm/dd hh24:mi:ss'),'3fd59508b475406abdf88b433b4c1e94.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:05:14','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:05:14','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 10:05:14,931] [14] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:05:14,935] [14] [BetchLogic > run > 开始导入:2018/12/21 上午10:05:14]
[INFO ] [2018-12-21 10:05:15,254] [14] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:05:18,011] [14] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:05:18,411] [14] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:05:18,730] [14] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:05:18,999] [14] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:05:19,295] [14] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:05:19,671] [14] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:05:20,098] [14] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:05:20,412] [14] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:05:20,721] [14] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:05:20,721] [14] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:26:26,489] [44] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:26:26,587] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:26:26,594] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:26:26,595] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:26:26,598] [44] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:26:26,601] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:26:26,606] [44] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:26:26,607] [44] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:26:27,346] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:26:27,352] [44] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('c2898a2111d149289090e535293f95c2','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:26:27','yyyy/mm/dd hh24:mi:ss'),'c2898a2111d149289090e535293f95c2.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:26:27','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:26:27','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 10:26:27,359] [44] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:26:27,364] [44] [BetchLogic > run > 开始导入:2018/12/21 上午10:26:27]
[INFO ] [2018-12-21 10:26:28,155] [44] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:26:28,454] [44] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:26:28,737] [44] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:26:29,052] [44] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:26:29,316] [44] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:26:29,622] [44] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:26:29,896] [44] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:26:30,170] [44] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:26:30,477] [44] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:26:30,742] [44] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:26:30,742] [44] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:26:32,163] [37] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:26:32,190] [37] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:26:32,194] [37] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:26:32,196] [37] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:26:32,199] [37] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='1ffb8827cedf4547a45f81513abff23c']
[DEBUG] [2018-12-21 10:26:32,205] [37] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:26:32,228] [37] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA2 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:26:32,228] [37] [	delete from TBL_1220_DATA2 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:26:36,535] [37] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:26:36,538] [37] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('5cea9155f5dd4a26a49e9c302a660c3a','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:26:36','yyyy/mm/dd hh24:mi:ss'),'5cea9155f5dd4a26a49e9c302a660c3a.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:26:36','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:26:36','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'sw@1220,1.1.1.1,12202018001,1.txt','TBL_1220_DATA2','1ffb8827cedf4547a45f81513abff23c')]
[DEBUG] [2018-12-21 10:26:36,540] [37] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA2'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:26:36,543] [37] [BetchLogic > run > 开始导入:2018/12/21 上午10:26:36]
[INFO ] [2018-12-21 10:26:36,842] [37] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:26:39,322] [37] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:26:39,614] [37] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:26:39,875] [37] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:26:40,172] [37] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:26:41,630] [37] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:26:41,936] [37] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:26:42,232] [37] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:26:42,497] [37] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:26:45,154] [37] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:26:45,154] [37] [BetchLogic > run > 全部写入完成:100000]
[DEBUG] [2018-12-21 10:28:27,415] [35] [	with a as(select t.parent_id parent_id, min(t.plan_code_gantt) min_task_code
  from mpm.pm_task_info t
 where t.actual_e_date is null
   and (t.accept_state <> '3' or t.accept_state is null)
   and t.task_type = '1'
   and t.id in (select pti.parent_id
                  from mpm.pm_task_info pti left join pt6.sys_user su
                       on pti.user_id = su.id
                 where pti.pm_task_type = '1' and (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = pti.id and su1.login_name = 'shaozj'
                 ))) --包含下达给试验部公布的工序
 group by t.parent_id
),
--查询所有任务下的按顺序应当执行的工序code对应的ID
b as (
  select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
  and pti1.task_name not like '%_A' AND  pti1.task_name NOT LIKE '%_B'
  and pti1.task_name not like '%_C' AND  pti1.task_name NOT LIKE '%_D'
),
--查询带ABCD的科研工序，只能查询上一未做的阶段工序
b1 as(
 select a.parent_id,a.min_task_code,pti1.id from mpm.pm_task_info pti1,a
  where pti1.parent_id = a.parent_id 
    and ((pti1.TASK_NAME  LIKE '%_A' AND nvl(pti1.ACTUAL_PROGRESS,0)<100)
OR(pti1.TASK_NAME LIKE '%_B' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_A' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 OR(pti1.TASK_NAME LIKE '%_C' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_B' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
  OR(pti1.TASK_NAME LIKE '%_D' AND nvl(pti1.ACTUAL_PROGRESS,0)<100 AND 
 NOT EXISTS(SELECT 1 FROM mpm.PM_TASK_INFO WHERE PARENT_ID=pti1.PARENT_ID AND TASK_NAME LIKE '%_C' 
 AND nvl(ACTUAL_PROGRESS,0)<100))
 ) 
),
b2 as (
select parent_id,min_task_code,id from b
union all
select parent_id,min_task_code,id from b1
),
--查询该工序节点父节点和子节点的信息
d as(
  select distinct pti2.* from mpm.pm_task_info pti2,b2
  where pti2.parent_id = b2.id or b2.parent_id = pti2.id or pti2.id=b2.id
  and pti2.actual_e_date is null
  and pti2.accept_state <> '3'
),
--过滤工步不为登陆人的工步
c as (
  select d.* from d
  left join pt6.sys_user su
  on d.user_id=su.id
  where (su.login_name='shaozj' or exists(
                 select 1 from tdm.tdm_task_rsrc_user ttru left join pt6.sys_user su1 on ttru.user_id = su1.id
                 where ttru.task_id = d.id and su1.login_name = 'shaozj')) or d.task_type<>0
)
select c.id, --WBS/任务的唯一标识
       decode(c.task_type, 0, '工步', 1, '工序', 2, '里程碑', 3,'任务','') task_type, --类型
       pp.project_code, --项目code
       pp.project_name, --项目名称
       c.plan_s_date, --计划开始时间
       c.plan_e_date, --计划结束时间
       c.actual_s_date, --实际开始时间
       c.actual_e_date, --实际结束时间
       (select attribute_07 from mpm.pm_task_info where instr(c.task_path,id)>0 and        task_type='3')attribute_07, --任务项目编号
       c.plan_code_gantt, --任务名称
       c.task_name, --任务名称
       c.task_code, --任务code
       su.login_name, --登入名
       sdv.dept_name, --部门名称
       syu.login_name as PLAN_MANAGER_name, --主管名称
       c.INTERFACE_STATE , --任务状态
       c.parent_id --父节点ID
       from c
left join pt6.sys_user su
    on c.user_id = su.id --通过user_id左连接 系统用户表 拿到 用户登入名
  left join pt6.sys_user syu
    on c.plan_manager_id = syu.id --通过plan_manager_id左连接 系统用户表 拿到 主管名称
  left join pt6.sys_dept_v sdv
    on c.dept_id = sdv.id --通过dept_id左连接 部门表视图 拿到 部门名称
  left join pt6.pm_project pp
    on c.pm_project_id = pp.id --通过pm_project_id左连接 项目结构信息表 拿到 项目code 项目名称
 where c.task_status = '30' --状态 等于30(已下达)
   and nvl(c.ACTUAL_PROGRESS, 0) < 100 --并且 计划实际完成百分比%小于100 order by c.plan_code_gantt


]
[DEBUG] [2018-12-21 10:28:27,450] [35] [	SELECT * FROM MDS_IMP_DATA_SCRIPT]
[DEBUG] [2018-12-21 10:28:27,453] [35] [	SELECT * FROM MDS_IMP_DATA_SCRIPT WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:28:27,454] [35] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_RULE WHERE FID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:28:27,456] [35] [	SELECT * FROM MDS_IMP_DATA_SCRIPT_MAP WHERE MDS_IMP_DATA_SCRIPT_RULE_ID='512950b178534c24a6033392af0bd08d']
[DEBUG] [2018-12-21 10:28:27,459] [35] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:28:27,465] [35] [BetchLogic > updateDbByID > 删除数据:TBL_1220_DATA1 -> taskid: 8a53b79267c9ba700167c9bd4c2b0011  times: 1]
[DEBUG] [2018-12-21 10:28:27,465] [35] [	delete from TBL_1220_DATA1 where PROJECTID ='8a53b79267c9ba700167c9bd4c2b0011' and TASKTIMES=1]
[DEBUG] [2018-12-21 10:28:30,902] [35] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[DEBUG] [2018-12-21 10:28:30,905] [35] [	INSERT INTO MDS_IMP_DATA_LOG(FID,TEST_PROJECT_ID,IMP_DATE_TIME,FULL_FLODERNAME,IMPROWSCOUNT,IMP_STATUS,ERROR_MSG,CREATED_BY,CREATION_DATE,LAST_UPDATED_BY,LAST_UPDATE_DATE,LAST_UPDATE_IP,VERSION,IMPFILENAME,OBJECT_TABLE,TYPENAME) VALUES('8fd3f8a702d24f5da89e8804fb1bcfa7','8a53b79267c9ba700167c9bd4c2b0011',to_date('2018/12/21 10:28:30','yyyy/mm/dd hh24:mi:ss'),'8fd3f8a702d24f5da89e8804fb1bcfa7.txt','0','','','4028b48152632a160152635092f7000e',to_date('2018/12/21 10:28:30','yyyy/mm/dd hh24:mi:ss'),'4028b48152632a160152635092f7000e',to_date('2018/12/21 10:28:30','yyyy/mm/dd hh24:mi:ss'),'127.0.0.1',1,'mx@1220,1.1.1.1,12202018000,1.txt','TBL_1220_DATA1','512950b178534c24a6033392af0bd08d')]
[DEBUG] [2018-12-21 10:28:30,907] [35] [	select t.table_name,t.column_name,t.data_type,t.data_length,t.nullable,t.column_id,c.comments
       FROM user_tab_cols t, user_col_comments c
       WHERE upper(t.table_name)='TBL_1220_DATA1'   
             and c.table_name=t.table_name   
             and c.column_name=t.column_name   
             and t.hidden_column='NO'   
 order by t.column_id ]
[INFO ] [2018-12-21 10:28:30,910] [35] [BetchLogic > run > 开始导入:2018/12/21 上午10:28:30]
[INFO ] [2018-12-21 10:28:31,177] [35] [BetchLogic > run > 凑够10000行写一次库 :9999]
[INFO ] [2018-12-21 10:28:31,481] [35] [BetchLogic > run > 凑够10000行写一次库 :19999]
[INFO ] [2018-12-21 10:28:33,576] [35] [BetchLogic > run > 凑够10000行写一次库 :29999]
[INFO ] [2018-12-21 10:28:33,880] [35] [BetchLogic > run > 凑够10000行写一次库 :39999]
[INFO ] [2018-12-21 10:28:34,149] [35] [BetchLogic > run > 凑够10000行写一次库 :49999]
[INFO ] [2018-12-21 10:28:34,453] [35] [BetchLogic > run > 凑够10000行写一次库 :59999]
[INFO ] [2018-12-21 10:28:34,725] [35] [BetchLogic > run > 凑够10000行写一次库 :69999]
[INFO ] [2018-12-21 10:28:34,989] [35] [BetchLogic > run > 凑够10000行写一次库 :79999]
[INFO ] [2018-12-21 10:28:35,294] [35] [BetchLogic > run > 凑够10000行写一次库 :89999]
[INFO ] [2018-12-21 10:28:35,569] [35] [BetchLogic > run > 凑够10000行写一次库 :99999]
[INFO ] [2018-12-21 10:28:35,569] [35] [BetchLogic > run > 全部写入完成:100000]